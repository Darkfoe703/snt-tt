<!-- app/infrastructure/api/web/templates/market.html -->
{% extends "base.html" %}

{% block content %}
<article>
    <hgroup>
        <h1>üìà Mercado</h1>
        <h2>Datos de mercado en tiempo real</h2>
    </hgroup>

    <div class="card">
        <h3>üîç Explorador de Mercado</h3>
        <form hx-get="/market" hx-target="#results-area" hx-indicator="#loading">
            <input type="hidden" name="submitted" value="true">
            <div class="grid">
                <label for="region_id">
                    Regi√≥n
                    <select id="region_id" name="region_id">
                        {% for region_value, region_name in regions %}
                        <option value="{{ region_value }}" {% if region_id==region_value %}selected{% endif %}>
                            {{ region_name }}
                        </option>
                        {% endfor %}
                    </select>
                </label>
                <label for="min_volume">
                    Volumen M√≠nimo
                    <input type="number" id="min_volume" name="min_volume" value="{{ min_volume }}" required>
                </label>
                <label for="min_spread">
                    Spread M√≠nimo (%)
                    <input type="number" step="0.1" id="min_spread" name="min_spread" value="{{ min_spread }}" required>
                </label>
                <label for="limit">
                    Oportunidades
                    <input type="number" id="limit" name="limit" value="{{ limit }}" required>
                </label>
                <label for="analysis_limit">
                    L√≠mite de An√°lisis
                    <input type="number" id="analysis_limit" name="analysis_limit" value="{{ analysis_limit }}"
                        required>
                </label>
            </div>
            <button type="submit">Analizar Mercado</button>
        </form>
    </div>

    <!-- Loading Indicator -->
    <div id="loading" class="htmx-indicator" style="text-align: center; margin-top: 2rem; display: none;">
        <article aria-busy="true">Analizando mercado, por favor espere...</article>
    </div>

    <!-- Results Area -->
    <div id="results-area">
        {% include 'partials/market_results.html' %}
    </div>

    <div class="grid" style="margin-top: 2rem;">
        <a href="/" role="button" class="secondary">‚Üê Volver al Dashboard</a>
        <a href="/api/docs" role="button" class="outline">üìö Usar API</a>
    </div>
</article>

<style>
    .htmx-indicator {
        opacity: 0;
        transition: opacity 200ms ease-in;
    }

    .htmx-request .htmx-indicator {
        opacity: 1;
        display: block !important;
    }

    .htmx-request.htmx-indicator {
        opacity: 1;
        display: block !important;
    }
</style>
{% endblock %}